import React from 'react'
import { useCssHandles } from 'vtex.css-handles'
import { OrderForm } from 'vtex.order-manager'
import { PixelContext } from 'vtex.pixel-manager'

export const CartIcon = () => (
  <div style={{ minWidth: 25, minHeight: 25 }}>
    <svg
      width="20"
      height="20"
      viewBox="0 0 20 20"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M5.89721 4.95745C5.92253 4.41906 5.91529 3.91884 5.97377 3.42696C6.19321 1.59419 7.68043 0.197256 9.54444 0.0243538C10.4288 -0.0579241 11.2722 0.0625116 12.0571 0.473901C13.4847 1.22215 14.1177 2.45036 14.1816 4.00588C14.1942 4.31592 14.1834 4.62654 14.1834 4.95745C14.5457 4.95745 14.8827 4.95685 15.2191 4.95745C16.0727 4.95983 16.5586 5.37241 16.6406 6.21486C16.769 7.53191 16.8709 8.85193 16.9842 10.1708C17.1283 11.8449 17.273 13.5191 17.417 15.1939C17.5129 16.3052 17.6178 17.416 17.7004 18.5279C17.7685 19.4485 17.2404 19.9904 16.3066 19.9904C12.1102 19.9904 7.91434 19.9785 3.71851 20C2.83594 20.0047 2.21561 19.3459 2.30182 18.4957C2.49292 16.6093 2.63579 14.7181 2.79736 12.8293C2.93903 11.1694 3.07949 9.51015 3.22056 7.85028C3.26818 7.28746 3.30918 6.72344 3.36584 6.1612C3.4406 5.41295 3.93674 4.97056 4.70296 4.95923C5.09964 4.95327 5.49692 4.95804 5.8966 4.95804L5.89721 4.95745ZM5.92132 6.03183C5.47642 6.03183 5.06407 6.02825 4.65172 6.03361C4.50221 6.036 4.45218 6.14213 4.44133 6.27568C4.41239 6.63162 4.38044 6.98696 4.3503 7.34291C4.19416 9.18104 4.03923 11.0192 3.88249 12.8567C3.71851 14.7759 3.55273 16.6952 3.38936 18.615C3.36765 18.8731 3.41106 18.9178 3.67089 18.9178C7.89083 18.9178 12.1108 18.9178 16.3307 18.9178C16.6056 18.9178 16.6424 18.8821 16.6207 18.5989C16.5815 18.0873 16.5327 17.5764 16.4893 17.0648C16.3627 15.5826 16.2373 14.1004 16.1101 12.6182C15.9805 11.1062 15.8496 9.59481 15.7194 8.08281C15.6694 7.49733 15.6218 6.91184 15.5693 6.32636C15.5585 6.20175 15.5573 6.04494 15.3848 6.03958C14.9894 6.02765 14.5933 6.036 14.1828 6.036C14.1828 6.4462 14.1846 6.83254 14.1828 7.21889C14.1804 7.58914 13.9681 7.83419 13.6498 7.84015C13.3225 7.84671 13.1025 7.59749 13.1006 7.21472C13.0988 6.82897 13.1006 6.44322 13.1006 6.04315H7.00404C7.00404 6.44083 7.00585 6.82599 7.00404 7.21174C7.00163 7.59332 6.77978 7.84373 6.45424 7.84074C6.13413 7.83717 5.92373 7.5957 5.92192 7.22247C5.92011 6.83612 5.92192 6.44977 5.92192 6.03183H5.92132ZM13.0946 4.94731C13.0946 4.54904 13.1151 4.17759 13.0904 3.80854C13.047 3.15508 12.8324 2.56006 12.3863 2.06162C11.4609 1.02779 9.82175 0.763662 8.52141 1.43679C7.335 2.05089 6.69478 3.5629 7.03961 4.94791H13.0952L13.0946 4.94731Z"
        fill="#1B1B1B"
      />
    </svg>
  </div>
)

const CSS_HANDLES = [
  'customMinicartButton',
  'customMinicartButtonContainer',
  'customMinicartButtonCount',
] as const

export default function CustomMiniCartButton({
  children,
}: {
  children: React.ReactNode
}) {
  const { push } = PixelContext.usePixel()
  const { orderForm } = OrderForm.useOrderForm() as any
  const { handles } = useCssHandles(CSS_HANDLES)

  const handleClick = () => {
    push({
      event: 'add-to-cart-button' as any,
      id: 'add-to-cart-button',
    })
  }

  return (
    <div className={handles.customMinicartButtonContainer}>
      <button className={handles.customMinicartButton} onClick={handleClick}>
        <CartIcon />
        <span className={handles.customMinicartButtonCount}>
          {orderForm.items.length}
        </span>
      </button>
      {children}
    </div>
  )
}
